# Prompts para la aplicación de análisis de movilidad
analysis_prompt: |
  You are an analyst specialised in corporate mobility plans.

  ### INPUTS
  1. questions = [  
        "1. Commercial name of the work centre (text)",  
        "2. Main activity – one of: manufacturing, offices, R&D, logistics, services",  
        "3. Full postal address (text)",  
        "4. Site typology – choose: industrial estate, urban core, university campus, rural, other",  
        "5. Public-transport offer: for each line give mode, stop name, avg. headway (table)",  
        "6. Active-mobility infrastructure nearby: safe walking routes, cycle lane, lit path, other (multi)",  
        "7. Total number of employees (int)",  
        "8. Covered parking for bikes/scooters: existence, exact capacity, location (text+int)",  
        "9. Car spaces: total and by building/floor (int + detail)",  
        "10. Motorcycle spaces (int)",  
        "11. Bicycle spaces (int)",  
        "12. Scooter spaces (int)",  
        "13. Reserved spaces: how many and for whom (table)",  
        "14. Access-control system: barrier, employee card, licence-plate reading, none (multi)",  
        "15. Safety measures in car park: CCTV, on-site guard, enhanced lighting, none (multi)",  
        "16. Nº and power (kW) of EV chargers (int + kW)",  
        "17. Location of EV chargers (text)",  
        "18. User groups with reserved EV bays (multi)",  
        "19. Charging management & cost (open)",  
        "20. Plugs for e-bikes/scooters: number & location (text+int)",  
        "21. % of staff on shifts + schedule of each shift (%, hh:mm-hh:mm)",  
        "22. % with flexitime + entry/exit window (%, hh:mm-hh:mm)",  
        "23. Tele-working allowance: max days/week & seasonal rules (open)",  
        "24. Professional/mixed corporate fleet: vehicle types, qty, private-use rules (open)",  
        "25. Taxi, car-sharing or other apps paid by company: app + annual services (open)",  
        "26. 24-h access control to building: guard, visitor log, CCTV, other (multi)",  
        "27. Up-front communication to visitors/suppliers on how to arrive car-free (yes/no + text)",  
        "28. Singular areas/services (open)",  
        "29. Sustainable-mobility initiatives already in place (open)"  
    ]  

  ────────────────────────────────────────────────────────
  ### TASKS  

  #### Phase 1 – Ingest & Clean  
  * Load csv info, is at the end.  

  #### Phase 2 – Answer Catalogue  
  For each work-centre row:  
  1. Map existing CSV columns to the corresponding question fields.  
  2. Where the answer is **calculable** (e.g. percentages, totals), compute it.  
  3. Output a JSON block like:  
      "center_id": "<row identifier>",
        "answers":
          "Q1": "...",
          "Q2": "...",
          ...
          "Q29": "..."
        

  #### Phase 3 – Mobility-Sustainability Analysis  
  For each centre:  
  * Derive **key sustainability indicators**, e.g.  
    * employee-to-bike-parking ratio  
    * EV-charger-to-car-space ratio  
    * share of staff on flexible vs. rigid schedules  
  * Flag **opportunities** such as:  
    * insufficient active-mobility facilities  
    * low EV-charger coverage  
    * lack of visitor guidance for car-free arrival  
  * Summarise findings in concise bullet points.  

  #### Phase 4 – Narrative Generation  
  Using the JSON answers **and** the Phase 3 insights, write the *“Center Categorization”* section in fluent Spanish (~300–400 words).  
  Structure it like the reference examples:  
  * **Intro paragraph**: company overview + main activities.  
  * **Location & access**: address, transport links, road access.  
  * **Facilities & parking**: numbers and special features.  
  * **Work patterns**: shifts, flexitime, telework.  
  * **Sustainability focus**: current strengths & improvement opportunities (clearly labelled).  
  Use an objective, informative tone.  

  ────────────────────────────────────────────────────────
  ### DELIVERABLES  
  1. `answers_<center_id>.json` for every row.  
  2. `categorization_<center_id>.md` containing the finished narrative.  

  ────────────────────────────────────────────────────────
  ### IMPORTANT RULES  
  * Keep code, comments and variables **in English**.  
  * Dates: use ISO 8601.  
  * Include units (kW, m, €) in outputs.  
  * If data missing → put `"N/A"` in JSON and omit from narrative.  

  ────────────────────────────────────────────────────────
  ### CSV CONTENT (append below this line)
  #  ⬇⬇  paste the entire comma-separated CSV here  ⬇⬇
  {data}

summary_prompt: |
  You are a **senior analyst specialized in sustainable mobility and workplace transport planning**.  
  Your task is to generate a corporate-level summary describing all work centers of a single company, based on structured data from each location.  
  You will follow strict analytical discipline: **no assumptions**, no invented content, and every insight must be directly backed by the data provided.

  Your final deliverable will be a single, well-written narrative in **Spanish**, structured like the Knorr-Bremse example, with a focus on **sustainable mobility strengths and improvement opportunities**.

  Continue with the following instructions:

  ### Objective  
  Generate a **single, unified** *Center Categorization* text covering all the company’s sites, following the narrative structure and tone of the **Knorr-Bremse example**, but focused entirely on **sustainable mobility**.

  The final output must:

  - Present each center’s location, workforce, and sustainable infrastructure.
  - Highlight work patterns that impact transportation needs.
  - Include company-wide **strengths** and **opportunities**.
  - Be written in **Spanish**, with a neutral and informative tone.
  - Be **100% grounded in the data provided** — no assumptions, hallucinations, or invented conclusions are allowed.

  ────────────────────────────────────────────────────────
  ### INPUTS  
  - `centers_data`: one block per center, each including:  
    • `answers_<center_id>.json` (questionnaire responses)  
    • `categorization_<center_id>.md` (individual narrative)  
  - `oneshot_example`: a full sample narrative to match tone and structure.
  - `company_name`: {company_name}

  ────────────────────────────────────────────────────────
  ### TASKS  

  #### Phase 1 – Parse Inputs  
  - Convert each JSON and Markdown block into a dictionary.  
  - Normalize keys to `snake_case`; fill any missing fields with `"N/A"`.

  #### Phase 2 – Compute Key Sustainable-Mobility Metrics  
  For each center:
  1. Extract: number of employees, bike parking, car spaces, EV chargers, % shift work, % flexitime, telework days.
  2. Calculate:  
    • `bike_ratio = employees / bike_parking`  
    • `ev_ratio = ev_chargers / car_spaces`
  3. Flag a center as an **opportunity** if any of the following apply:  
    • `bike_ratio > 6`  
    • `ev_ratio < 0.05`  
    • `answers.q27 == "no"` (no visitor guidance for car-free arrival)

  #### Phase 3 – Aggregate Company-Wide Metrics  
  - Compute global totals and averages for relevant metrics.  
  - Identify:  
    • `common_strengths`: features present in ≥ 75% of centers.  
    • `common_opportunities`: weaknesses present in ≥ 40% of centers.

  #### Phase 4 – Generate Narrative (Match **Knorr-Bremse** Structure)

  | Section | Content (sustainable mobility focus) | Target length |
  |---------|--------------------------------------|----------------|
  | **1. Corporate Introduction** | Brief overview: sector, countries, clients, and sustainability commitments. | 70–90 words |
  | **2. Center Summaries** | For **each center**: <br>• Name + summarized address <br>• Number of employees <br>• Main transport options (public + active) <br>• Key facilities: car/bike parking, EV chargers, reserved bays. | 60–70 words per center |
  | **3. Work Patterns** | Compare shift, flexitime, and telework setups; highlight implications for transport. | 60–80 words |
  | **4. Strengths in Sustainable Mobility** | Narrative list (not bullets) of positive features present in most centers. | 60–70 words |
  | **5. Opportunities** *(label this section “Oportunidades”)* | 3–5 concrete, data-driven improvement actions (e.g., more bike parking, signage for car-free visitors, EV charger expansion). | 60–80 words |

  **The entire output must be written in Spanish. No assumptions or hallucinations are allowed. Every claim must be fully supported by the source data.**

  ────────────────────────────────────────────────────────
  ### DELIVERABLE  
  A single file `company_summary.md`, ready to be included in the corporate Mobility Plan, 450–550 words.

  ────────────────────────────────────────────────────────
  ### IMPORTANT RULES  
  - Keep code, variables and comments in **English**.  
  - Use units (kW, plazas, %, etc.) and ISO 8601 for dates.  
  - If a value is “N/A” across all centers, omit it.  
  - Stay strictly within data-based conclusions — do not invent content.

  ────────────────────────────────────────────────────────
  ### ONE-SHOT EXAMPLE (style guide)  
  El grupo Knorr-Bremse desarrolla y fabrica sistemas de freno y otros
  subsistemas, principalmente para vehículos ferroviarios y comerciales.
  Knorr-Bremse Pamplona, S.L.U. (anteriormente Icer-Rail, S.L.) fue fundada
  en 2010 como Joint Venture entre el grupo español Berkelium y Knorr-
  Bremse España, y desde 2016 es 100% propiedad del grupo Knorr-Bremse.
  En Pamplona, España, la empresa se dedica al desarrollo y producción de
  guarniciones y zapatas de freno orgánicos, así como el desarrollo y la
  producción de elementos sinterizados de fricción para el sector ferroviario.
  Estos productos se aplican en la red ferroviaria de líneas de Renfe,
  EuskoTren, Feve, o las líneas de metro de Madrid, Sevilla o Bilbao, pero en su
  mayoría se suministran a clientes a nivel mundial.
  
  Knorr-Bremse Pamplona, S.L.U. (CIF B71037253) cuenta con un total de 202
  trabajadores/as y recibe unas 1.200 visitas anuales en sus dos centros de
  trabajo situados a una distancia de 150 metros entre sí, en el Polígono
  Industrial Agustinos del municipio de Pamplona (Navarra), CP 31013.
  El polígono tiene acceso directo para vehículos desde la Ronda de Pamplona
  y conecta con la autopista de Navarra (AP-15) y las carretera nacional
  NA-700 y las comarcales PA-30 y PA-34. Aunque está ubicado a las afueras de
  la ciudad hay rutas de itinerarios peatonales hasta los municipios de Orkoien
  y Berriozar, y el barrio de San Jorge.
  En el interior, los centros de trabajo cuentan con consignas, duchas y
  vestuarios para trabajadores, además de comedor.
  En cuanto al aparcamiento para la plantilla, se dispone de 91 plazas para
  coche, distribuidas entre los dos centros; 48 en HQ y 43 en Nave A1, y 10
  plazas para motos. Hay tres tipos de plazas reservadas en los aparcamientos.
  En HQ se reservan 2 plazas para gerencia, 3 para visitas y una para personas
  con movilidad reducida. En Nave A1 se reservan 2 plazas para visita y 1 para
  personas con movilidad reducida.
  Adicionalmente, los dos centros de trabajo tienen puntos de carga para
  vehículos eléctricos de potencia semi rápida. En HQ hay un total de 6 plazas,
  de las cuales 4 están reservadas para gerencia. En Nave A1, hay 2 plazas con
  puntos de carga. Los puntos de recarga son accesibles a través de la app
  "Electromaps" y el coste por Kwh varía con los precios de mercado.
  Actualmente el coste es de 0,25 €/Kwh. En HQ se ha habilitado una zona
  cubierta y cerrada con 8 plazas para bicicletas y patinetes.
  La mayoría de las personas empleadas en esta sede trabajan a jornada
  completa. Un 64% de la plantilla trabaja a turnos, la mayoría en producción.
  Estas personas tienden a rotar entre los tres turnos.

  El resto de la plantilla (36%) trabaja con horario flexible, la mayoría en
  oficina. Estas personas tienen la posibilidad de teletrabajar 1 día a la semana
  durante todo el año. Además, en verano pueden optar a un día más de
  teletrabajo a la semana.
